<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css?v=1.1">
    <title>Condom칤nio T Lacerda - Boletos e Contas</title>
    <script src="script.js" defer></script>
    <script type="module">
        // ==================== 游댠 IN칈CIO FIREBASE 游댠 ====================
        // Importa칞칚o das fun칞칫es necess치rias do Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        // Configura칞칚o do Firebase com as credenciais do projeto
        const firebaseConfig = {
            apiKey: "AIzaSyBzgHcrZNvCQEunq-d3LeDm0u4LDhwjDgM",
            authDomain: "logsite-d81dd.firebaseapp.com",
            databaseURL: "https://logsite-d81dd-default-rtdb.firebaseio.com",
            projectId: "logsite-d81dd",
            storageBucket: "logsite-d81dd.firebasestorage.app",
            messagingSenderId: "285508603780",
            appId: "1:285508603780:web:dba70ace036ee8a37297d1",
            measurementId: "G-B0JHRHTNKF"
        };

        // Inicializa칞칚o do aplicativo Firebase com a configura칞칚o fornecida
        const app = initializeApp(firebaseConfig);
        // Inicializa칞칚o do servi칞o de analytics do Firebase
        const analytics = getAnalytics(app);
        // Inicializa칞칚o do servi칞o de banco de dados em tempo real do Firebase
        const db = getDatabase();

        // Registra o evento de visualiza칞칚o da p치gina no Firebase Analytics
        logEvent(analytics, 'page_view');

        // Fun칞칚o para registrar acessos no Firebase com hor치rio correto (UTC-3)
        function logAccess(userCode, userName, apartment, accessedDocument) {
            // Captura a data e hora atuais
            const now = new Date();

            // Ajusta o hor치rio para o fuso hor치rio de Bras칤lia (UTC-3)
            now.setHours(now.getHours() - 3);

            // Formata a data e hora para um formato seguro para nome de arquivo
            const formattedDate = now.toISOString().replace('T', '_').split('.')[0];

            // Cria o nome do arquivo de log com informa칞칫es do usu치rio e data
            let fileName = `${userName}_Acesso_apartamento_${apartment}_${accessedDocument}_${userCode}_${formattedDate}`;
            // Remove caracteres inv치lidos do nome do arquivo
            fileName = fileName.replace(/[^a-zA-Z0-9_-]/g, '_');

            // Cria o objeto de log com os dados do acesso
            const accessLog = {
                userCode: userCode,
                userName: userName,
                apartment: `Acesso ao apartamento ${apartment}`,
                accessedDocument: accessedDocument,
                accessDate: now.toISOString() // Salva a data j치 no fuso hor치rio de Bras칤lia
            };

            // Cria uma refer칡ncia no banco de dados do Firebase para o log
            const logRef = ref(db, `logs/${fileName}`);
            // Salva o log no Firebase
            set(logRef, accessLog)
                .then(() => console.log("Log registrado com hor치rio correto:", now.toISOString()))
                .catch(error => console.error("Erro ao registrar log:", error));
        }

        // Disponibiliza a fun칞칚o logAccess para ser usada no script.js
        window.logAccess = logAccess;

        // ==================== 游댠 FIM FIREBASE 游댠 ====================
    </script>
</head>
<body>
    <header>
        <img src="images/logo_cond.jpg" alt="Logo do Condom칤nio" class="logo">
    </header>

    <h1>Condom칤nio T Lacerda</h1>
    <p id="welcome-message">Ol치! Eu sou a Lacerda, assistente virtual do Condom칤nio T Lacerda.<br>Por favor, digite seu c칩digo de acesso.</p>
    <input type="password" id="accessCode" placeholder="Digite seu c칩digo">
    <button onclick="enableApartment()">Acessar</button>

    <div class="apartment-section">
        <button class="apartment-button" id="apto1" disabled onclick="showFiles('1')">Apartamento 1</button>
        <button class="apartment-button" id="apto101" disabled onclick="showFiles('101')">Apartamento 101</button>
        <button class="apartment-button" id="apto102" disabled onclick="showFiles('102')">Apartamento 102</button>
        <button class="apartment-button" id="apto201" disabled onclick="showFiles('201')">Apartamento 201</button>
        <button class="apartment-button" id="apto202" disabled onclick="showFiles('202')">Apartamento 202</button>
        <button class="apartment-button" id="apto301" disabled onclick="showFiles('301')">Apartamento 301</button>
        <button class="apartment-button" id="apto302" disabled onclick="showFiles('302')">Apartamento 302</button>
        <button class="apartment-button" id="apto401" disabled onclick="showFiles('401')">Apartamento 401</button>
    </div>

    <div id="file-container" class="file-box" style="display: none;">
        <h2>Arquivos do Apartamento <span id="apartment-number"></span></h2>
        <ul class="file-list" id="file-list"></ul>
    </div>

    <div id="viewer-container" class="viewer-box" style="display: none;">
        <h2>Visualizador de Arquivos</h2>
        <iframe id="file-viewer" src="" frameborder="0"></iframe>
        <a id="download-button" href="#" download class="download-btn">Baixar Arquivo</a>
    </div>
</body>
</html>
